version: '3'

services:
        zookeeper:
                image: wurstmeister/zookeeper
                container_name: zookeeper
                ports:
                        - 2181:2181
                networks:
                        - my_network
        kafka:
                image: wurstmeister/kafka
                container_name: kafka
                ports:
                        - 9092:9092
                expose:
                        - 9093
                environment:
                        KAFKA_ADVERTISED_LISTENERS: INSIDE://kafka:9093,OUTSIDE://localhost:9092
                        KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: INSIDE:PLAINTEXT,OUTSIDE:PLAINTEXT
                        KAFKA_LISTENERS: INSIDE://0.0.0.0:9093,OUTSIDE://0.0.0.0:9092
                        KAFKA_INTER_BROKER_LISTENER_NAME: INSIDE
                        KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
                        KAFKA_CREATE_TOPICS: topictest:1:1
                volumes:
                        - /var/run/docker.sock:/var/run/docker.sock
                networks:
                        - my_network

        streaming-scraper:
                container_name: streaming-scraper
                build:
                        dockerfile: Dockerfile
                        context: ./streaming-scraper

                depends_on:
                        - kafka

                tty: true
                volumes:
                        - ./streaming-scraper/app:/app/

                working_dir: /app/
                command: python3 StreamingScraper.py
                restart: always
                networks: 
                        - my_network
        
        car-recognizer:
                container_name: car-recognizer
                build:
                        dockerfile: Dockerfile
                        context: ./car-rec

                depends_on:
                        - kafka

                volumes:
                        - ./car-rec/app:/app/

                tty: true
                working_dir: /app/
                command: python3 car_rec.py
                restart: always
                networks: 
                        - my_network
     


networks:
        my_network:
                external: true

#volumes:
#  rs1: 
#  rs2: 
#  rs3: 

